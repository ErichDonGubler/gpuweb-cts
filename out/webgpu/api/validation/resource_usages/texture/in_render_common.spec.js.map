{"version":3,"sources":["../../../../../../src/webgpu/api/validation/resource_usages/texture/in_render_common.spec.ts"],"names":["description","makeTestGroup","assert","unreachable","ValidationTest","F","getColorAttachment","texture","textureViewDescriptor","view","createView","clearValue","r","g","b","a","loadOp","storeOp","createBindGroupForTest","textureView","textureUsage","sampleType","bindGroupLayoutEntry","binding","visibility","GPUShaderStage","FRAGMENT","viewDimension","storageTexture","access","format","layout","device","createBindGroupLayout","entries","createBindGroup","resource","isRangeNotOverlapped","start0","end0","start1","end1","kTextureSize","kTextureLevels","kTextureLayers","test","desc","params","u","combine","unless","t","inSamePass","level0","level1","fn","layer0","layer1","createTexture","usage","GPUTextureUsage","RENDER_ATTACHMENT","size","mipLevelCount","colorAttachment1","baseArrayLayer","arrayLayerCount","baseMipLevel","colorAttachment2","encoder","createCommandEncoder","renderPass","beginRenderPass","colorAttachments","end","renderPass1","renderPass2","success","expectValidationError","finish","combineWithParams","bgLevel","bgLevelCount","bgLayer","bgLayerCount","bgUsage","colorAttachmentLevel","colorAttachmentLayer","TEXTURE_BINDING","STORAGE_BINDING","bindGroupView","dimension","bindGroup","colorAttachment","setBindGroup","texture2","isMipLevelNotOverlapped","isArrayLayerNotOverlapped","isNotOverlapped","dsLevel","dsLayer","dsReadOnly","bgAspect","aspect","attachmentView","depthStencilAttachment","depthReadOnly","depthLoadOp","depthStoreOp","stencilReadOnly","stencilLoadOp","stencilStoreOp","bg0BaseLevel","bg0LevelCount","bg0BaseLayer","bg0LayerCount","bg1BaseLevel","bg1LevelCount","bg1BaseLayer","bg1LayerCount","bgUsage0","bgUsage1","bg0","bg1","bindGroup0","bindGroup1","colorTexture","bindGroupView0BaseLevel","bindGroupView0LevelCount","bindGroupView0BaseLayer","bindGroupView0LayerCount","bindGroupView1BaseLevel","bindGroupView1LevelCount","bindGroupView1BaseLayer","bindGroupView1LayerCount","bindGroupAspect0","bindGroupAspect1","bindGroupView0","bindGroupView1","sampleType0","sampleType1"],"mappings":"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","sourcesContent":["export const description = `\nTexture Usages Validation Tests in Same or Different Render Pass Encoders.\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { assert, unreachable } from '../../../../../common/util/util.js';\nimport { ValidationTest } from '../../validation_test.js';\n\nclass F extends ValidationTest {\n  getColorAttachment(\n    texture: GPUTexture,\n    textureViewDescriptor?: GPUTextureViewDescriptor\n  ): GPURenderPassColorAttachment {\n    const view = texture.createView(textureViewDescriptor);\n\n    return {\n      view,\n      clearValue: { r: 1.0, g: 0.0, b: 0.0, a: 1.0 },\n      loadOp: 'clear',\n      storeOp: 'store',\n    };\n  }\n\n  createBindGroupForTest(\n    textureView: GPUTextureView,\n    textureUsage: 'texture' | 'storage',\n    sampleType: 'float' | 'depth' | 'uint'\n  ) {\n    const bindGroupLayoutEntry: GPUBindGroupLayoutEntry = {\n      binding: 0,\n      visibility: GPUShaderStage.FRAGMENT,\n    };\n    switch (textureUsage) {\n      case 'texture':\n        bindGroupLayoutEntry.texture = { viewDimension: '2d-array', sampleType };\n        break;\n      case 'storage':\n        bindGroupLayoutEntry.storageTexture = {\n          access: 'write-only',\n          format: 'rgba8unorm',\n          viewDimension: '2d-array',\n        };\n        break;\n      default:\n        unreachable();\n        break;\n    }\n    const layout = this.device.createBindGroupLayout({\n      entries: [bindGroupLayoutEntry],\n    });\n    return this.device.createBindGroup({\n      layout,\n      entries: [{ binding: 0, resource: textureView }],\n    });\n  }\n\n  isRangeNotOverlapped(start0: number, end0: number, start1: number, end1: number): boolean {\n    assert(start0 <= end0 && start1 <= end1);\n    // There are only two possibilities for two non-overlapped ranges:\n    // [start0, end0] [start1, end1] or\n    // [start1, end1] [start0, end0]\n    return end0 < start1 || end1 < start0;\n  }\n}\n\nexport const g = makeTestGroup(F);\n\nconst kTextureSize = 16;\nconst kTextureLevels = 3;\nconst kTextureLayers = 3;\n\ng.test('subresources,color_attachments')\n  .desc(\n    `\n  Test that the different subresource of the same texture are allowed to be used as color\n  attachments in same / different render pass encoder, while the same subresource is only allowed\n  to be used as different color attachments in different render pass encoders.`\n  )\n  .params(u =>\n    u\n      .combine('layer0', [0, 1])\n      .combine('level0', [0, 1])\n      .combine('layer1', [0, 1])\n      .combine('level1', [0, 1])\n      .combine('inSamePass', [true, false])\n      .unless(t => t.inSamePass && t.level0 !== t.level1)\n  )\n  .fn(async t => {\n    const { layer0, level0, layer1, level1, inSamePass } = t.params;\n\n    const texture = t.device.createTexture({\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n      size: [kTextureSize, kTextureSize, kTextureLayers],\n      mipLevelCount: kTextureLevels,\n    });\n\n    const colorAttachment1 = t.getColorAttachment(texture, {\n      baseArrayLayer: layer0,\n      arrayLayerCount: 1,\n      baseMipLevel: level0,\n      mipLevelCount: 1,\n    });\n    const colorAttachment2 = t.getColorAttachment(texture, {\n      baseArrayLayer: layer1,\n      baseMipLevel: level1,\n      mipLevelCount: 1,\n    });\n    const encoder = t.device.createCommandEncoder();\n    if (inSamePass) {\n      const renderPass = encoder.beginRenderPass({\n        colorAttachments: [colorAttachment1, colorAttachment2],\n      });\n      renderPass.end();\n    } else {\n      const renderPass1 = encoder.beginRenderPass({\n        colorAttachments: [colorAttachment1],\n      });\n      renderPass1.end();\n      const renderPass2 = encoder.beginRenderPass({\n        colorAttachments: [colorAttachment2],\n      });\n      renderPass2.end();\n    }\n\n    const success = inSamePass ? layer0 !== layer1 : true;\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, !success);\n  });\n\ng.test('subresources,color_attachment_and_bind_group')\n  .desc(\n    `\n  Test that when one subresource of a texture is used as a color attachment, it cannot be used in a\n  bind group simultaneously in the same render pass encoder. It is allowed when the bind group is\n  used in another render pass encoder instead of the same one.`\n  )\n  .params(u =>\n    u\n      .combine('colorAttachmentLevel', [0, 1])\n      .combine('colorAttachmentLayer', [0, 1])\n      .combineWithParams([\n        { bgLevel: 0, bgLevelCount: 1 },\n        { bgLevel: 1, bgLevelCount: 1 },\n        { bgLevel: 1, bgLevelCount: 2 },\n      ])\n      .combineWithParams([\n        { bgLayer: 0, bgLayerCount: 1 },\n        { bgLayer: 1, bgLayerCount: 1 },\n        { bgLayer: 1, bgLayerCount: 2 },\n      ])\n      .combine('bgUsage', ['texture', 'storage'] as const)\n      .unless(t => t.bgUsage === 'storage' && t.bgLevelCount > 1)\n      .combine('inSamePass', [true, false])\n  )\n  .fn(async t => {\n    const {\n      colorAttachmentLevel,\n      colorAttachmentLayer,\n      bgLevel,\n      bgLevelCount,\n      bgLayer,\n      bgLayerCount,\n      bgUsage,\n      inSamePass,\n    } = t.params;\n\n    const texture = t.device.createTexture({\n      format: 'rgba8unorm',\n      usage:\n        GPUTextureUsage.RENDER_ATTACHMENT |\n        GPUTextureUsage.TEXTURE_BINDING |\n        GPUTextureUsage.STORAGE_BINDING,\n      size: [kTextureSize, kTextureSize, kTextureLayers],\n      mipLevelCount: kTextureLevels,\n    });\n    const bindGroupView = texture.createView({\n      dimension: '2d-array',\n      baseArrayLayer: bgLayer,\n      arrayLayerCount: bgLayerCount,\n      baseMipLevel: bgLevel,\n      mipLevelCount: bgLevelCount,\n    });\n    const bindGroup = t.createBindGroupForTest(bindGroupView, bgUsage, 'float');\n\n    const colorAttachment = t.getColorAttachment(texture, {\n      baseArrayLayer: colorAttachmentLayer,\n      arrayLayerCount: 1,\n      baseMipLevel: colorAttachmentLevel,\n      mipLevelCount: 1,\n    });\n\n    const encoder = t.device.createCommandEncoder();\n    const renderPass = encoder.beginRenderPass({\n      colorAttachments: [colorAttachment],\n    });\n    if (inSamePass) {\n      renderPass.setBindGroup(0, bindGroup);\n      renderPass.end();\n    } else {\n      renderPass.end();\n\n      const texture2 = t.device.createTexture({\n        format: 'rgba8unorm',\n        usage: GPUTextureUsage.RENDER_ATTACHMENT,\n        size: [kTextureSize, kTextureSize, 1],\n        mipLevelCount: 1,\n      });\n      const colorAttachment2 = t.getColorAttachment(texture2);\n      const renderPass2 = encoder.beginRenderPass({\n        colorAttachments: [colorAttachment2],\n      });\n      renderPass2.setBindGroup(0, bindGroup);\n      renderPass2.end();\n    }\n\n    const isMipLevelNotOverlapped = t.isRangeNotOverlapped(\n      colorAttachmentLevel,\n      colorAttachmentLevel,\n      bgLevel,\n      bgLevel + bgLevelCount - 1\n    );\n    const isArrayLayerNotOverlapped = t.isRangeNotOverlapped(\n      colorAttachmentLayer,\n      colorAttachmentLayer,\n      bgLayer,\n      bgLayer + bgLayerCount - 1\n    );\n    const isNotOverlapped = isMipLevelNotOverlapped || isArrayLayerNotOverlapped;\n\n    const success = inSamePass ? isNotOverlapped : true;\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, !success);\n  });\n\ng.test('subresources,depth_stencil_attachment_and_bind_group')\n  .desc(\n    `\n  Test that when one subresource of a texture is used as a depth stencil attachment, it cannot be\n  used in a bind group simultaneously in the same render pass encoder. It is allowed when the bind\n  group is used in another render pass encoder instead of the same one, or the subresource is used\n  as a read-only depth stencil attachment.`\n  )\n  .params(u =>\n    u\n      .combine('dsLevel', [0, 1])\n      .combine('dsLayer', [0, 1])\n      .combineWithParams([\n        { bgLevel: 0, bgLevelCount: 1 },\n        { bgLevel: 1, bgLevelCount: 1 },\n        { bgLevel: 1, bgLevelCount: 2 },\n      ])\n      .combineWithParams([\n        { bgLayer: 0, bgLayerCount: 1 },\n        { bgLayer: 1, bgLayerCount: 1 },\n        { bgLayer: 1, bgLayerCount: 2 },\n      ])\n      .combine('dsReadOnly', [true, false])\n      .combine('bgAspect', ['depth-only', 'stencil-only'] as const)\n      .combine('inSamePass', [true, false])\n  )\n  .fn(async t => {\n    const {\n      dsLevel,\n      dsLayer,\n      bgLevel,\n      bgLevelCount,\n      bgLayer,\n      bgLayerCount,\n      dsReadOnly,\n      bgAspect,\n      inSamePass,\n    } = t.params;\n\n    const texture = t.device.createTexture({\n      format: 'depth24plus-stencil8',\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\n      size: [kTextureSize, kTextureSize, kTextureLayers],\n      mipLevelCount: kTextureLevels,\n    });\n    const bindGroupView = texture.createView({\n      dimension: '2d-array',\n      baseArrayLayer: bgLayer,\n      arrayLayerCount: bgLayerCount,\n      baseMipLevel: bgLevel,\n      mipLevelCount: bgLevelCount,\n      aspect: bgAspect,\n    });\n    const sampleType = bgAspect === 'depth-only' ? 'depth' : 'uint';\n    const bindGroup = t.createBindGroupForTest(bindGroupView, 'texture', sampleType);\n\n    const attachmentView = texture.createView({\n      baseArrayLayer: dsLayer,\n      arrayLayerCount: 1,\n      baseMipLevel: dsLevel,\n      mipLevelCount: 1,\n    });\n    const depthStencilAttachment: GPURenderPassDepthStencilAttachment = {\n      view: attachmentView,\n      depthReadOnly: dsReadOnly,\n      depthLoadOp: 'load',\n      depthStoreOp: 'store',\n      stencilReadOnly: dsReadOnly,\n      stencilLoadOp: 'load',\n      stencilStoreOp: 'store',\n    };\n\n    const encoder = t.device.createCommandEncoder();\n    const renderPass = encoder.beginRenderPass({\n      colorAttachments: [],\n      depthStencilAttachment,\n    });\n    if (inSamePass) {\n      renderPass.setBindGroup(0, bindGroup);\n      renderPass.end();\n    } else {\n      renderPass.end();\n\n      const texture2 = t.device.createTexture({\n        format: 'rgba8unorm',\n        usage: GPUTextureUsage.RENDER_ATTACHMENT,\n        size: [kTextureSize, kTextureSize, 1],\n        mipLevelCount: 1,\n      });\n      const colorAttachment2 = t.getColorAttachment(texture2);\n      const renderPass2 = encoder.beginRenderPass({\n        colorAttachments: [colorAttachment2],\n      });\n      renderPass2.setBindGroup(0, bindGroup);\n      renderPass2.end();\n    }\n\n    const isMipLevelNotOverlapped = t.isRangeNotOverlapped(\n      dsLevel,\n      dsLevel,\n      bgLevel,\n      bgLevel + bgLevelCount - 1\n    );\n    const isArrayLayerNotOverlapped = t.isRangeNotOverlapped(\n      dsLayer,\n      dsLayer,\n      bgLayer,\n      bgLayer + bgLayerCount - 1\n    );\n    const isNotOverlapped = isMipLevelNotOverlapped || isArrayLayerNotOverlapped;\n\n    const success = !inSamePass || isNotOverlapped || dsReadOnly;\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, !success);\n  });\n\ng.test('subresources,multiple_bind_groups')\n  .desc(\n    `\n  Test that when one color texture subresource is bound to different bind groups, its list of\n  internal usages within one usage scope can only be a compatible usage list. For texture\n  subresources in bind groups, the compatible usage lists are {TEXTURE_BINDING} and\n  {STORAGE_BINDING}, which means it can only be bound as both TEXTURE_BINDING and STORAGE_BINDING in\n  different render pass encoders, otherwise a validation error will occur.`\n  )\n  .params(u =>\n    u\n      .combineWithParams([\n        { bg0BaseLevel: 0, bg0LevelCount: 1 },\n        { bg0BaseLevel: 1, bg0LevelCount: 1 },\n        { bg0BaseLevel: 1, bg0LevelCount: 2 },\n      ])\n      .combineWithParams([\n        { bg0BaseLayer: 0, bg0LayerCount: 1 },\n        { bg0BaseLayer: 1, bg0LayerCount: 1 },\n        { bg0BaseLayer: 1, bg0LayerCount: 2 },\n      ])\n      .combineWithParams([\n        { bg1BaseLevel: 0, bg1LevelCount: 1 },\n        { bg1BaseLevel: 1, bg1LevelCount: 1 },\n        { bg1BaseLevel: 1, bg1LevelCount: 2 },\n      ])\n      .combineWithParams([\n        { bg1BaseLayer: 0, bg1LayerCount: 1 },\n        { bg1BaseLayer: 1, bg1LayerCount: 1 },\n        { bg1BaseLayer: 1, bg1LayerCount: 2 },\n      ])\n      .combine('bgUsage0', ['texture', 'storage'] as const)\n      .combine('bgUsage1', ['texture', 'storage'] as const)\n      .unless(\n        t =>\n          (t.bgUsage0 === 'storage' && t.bg0LevelCount > 1) ||\n          (t.bgUsage1 === 'storage' && t.bg1LevelCount > 1)\n      )\n      .combine('inSamePass', [true, false])\n  )\n  .fn(async t => {\n    const {\n      bg0BaseLevel,\n      bg0LevelCount,\n      bg0BaseLayer,\n      bg0LayerCount,\n      bg1BaseLevel,\n      bg1LevelCount,\n      bg1BaseLayer,\n      bg1LayerCount,\n      bgUsage0,\n      bgUsage1,\n      inSamePass,\n    } = t.params;\n\n    const texture = t.device.createTexture({\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.STORAGE_BINDING | GPUTextureUsage.TEXTURE_BINDING,\n      size: [kTextureSize, kTextureSize, kTextureLayers],\n      mipLevelCount: kTextureLevels,\n    });\n    const bg0 = texture.createView({\n      dimension: '2d-array',\n      baseArrayLayer: bg0BaseLayer,\n      arrayLayerCount: bg0LayerCount,\n      baseMipLevel: bg0BaseLevel,\n      mipLevelCount: bg0LevelCount,\n    });\n    const bg1 = texture.createView({\n      dimension: '2d-array',\n      baseArrayLayer: bg1BaseLayer,\n      arrayLayerCount: bg1LayerCount,\n      baseMipLevel: bg1BaseLevel,\n      mipLevelCount: bg1LevelCount,\n    });\n    const bindGroup0 = t.createBindGroupForTest(bg0, bgUsage0, 'float');\n    const bindGroup1 = t.createBindGroupForTest(bg1, bgUsage1, 'float');\n\n    const colorTexture = t.device.createTexture({\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n      size: [kTextureSize, kTextureSize, 1],\n      mipLevelCount: 1,\n    });\n    const colorAttachment = t.getColorAttachment(colorTexture);\n    const encoder = t.device.createCommandEncoder();\n    const renderPass = encoder.beginRenderPass({\n      colorAttachments: [colorAttachment],\n    });\n    if (inSamePass) {\n      renderPass.setBindGroup(0, bindGroup0);\n      renderPass.setBindGroup(1, bindGroup1);\n      renderPass.end();\n    } else {\n      renderPass.setBindGroup(0, bindGroup0);\n      renderPass.end();\n\n      const renderPass2 = encoder.beginRenderPass({\n        colorAttachments: [colorAttachment],\n      });\n      renderPass2.setBindGroup(1, bindGroup1);\n      renderPass2.end();\n    }\n\n    const isMipLevelNotOverlapped = t.isRangeNotOverlapped(\n      bg0BaseLevel,\n      bg0BaseLevel + bg0LevelCount - 1,\n      bg1BaseLevel,\n      bg1BaseLevel + bg1LevelCount - 1\n    );\n    const isArrayLayerNotOverlapped = t.isRangeNotOverlapped(\n      bg0BaseLayer,\n      bg0BaseLayer + bg0LayerCount - 1,\n      bg1BaseLayer,\n      bg1BaseLayer + bg1LayerCount - 1\n    );\n    const isNotOverlapped = isMipLevelNotOverlapped || isArrayLayerNotOverlapped;\n\n    const success = !inSamePass || isNotOverlapped || bgUsage0 === bgUsage1;\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, !success);\n  });\n\ng.test('subresources_from_same_depth_stencil_texture_in_bind_groups')\n  .desc(\n    `\n  Test that when one depth stencil texture subresource is bound to different bind groups, we can\n  always bind these two bind groups in either the same or different render pass encoder as the depth\n  stencil texture can only be bound as TEXTURE_BINDING in the bind group.`\n  )\n  .params(u =>\n    u\n      .combineWithParams([\n        { bindGroupView0BaseLevel: 0, bindGroupView0LevelCount: 1 },\n        { bindGroupView0BaseLevel: 1, bindGroupView0LevelCount: 1 },\n        { bindGroupView0BaseLevel: 1, bindGroupView0LevelCount: 2 },\n      ])\n      .combineWithParams([\n        { bindGroupView0BaseLayer: 0, bindGroupView0LayerCount: 1 },\n        { bindGroupView0BaseLayer: 1, bindGroupView0LayerCount: 1 },\n        { bindGroupView0BaseLayer: 1, bindGroupView0LayerCount: 2 },\n      ])\n      .combineWithParams([\n        { bindGroupView1BaseLevel: 0, bindGroupView1LevelCount: 1 },\n        { bindGroupView1BaseLevel: 1, bindGroupView1LevelCount: 1 },\n        { bindGroupView1BaseLevel: 1, bindGroupView1LevelCount: 2 },\n      ])\n      .combineWithParams([\n        { bindGroupView1BaseLayer: 0, bindGroupView1LayerCount: 1 },\n        { bindGroupView1BaseLayer: 1, bindGroupView1LayerCount: 1 },\n        { bindGroupView1BaseLayer: 1, bindGroupView1LayerCount: 2 },\n      ])\n      .combine('bindGroupAspect0', ['depth-only', 'stencil-only'] as const)\n      .combine('bindGroupAspect1', ['depth-only', 'stencil-only'] as const)\n      .combine('inSamePass', [true, false])\n  )\n  .fn(async t => {\n    const {\n      bindGroupView0BaseLevel,\n      bindGroupView0LevelCount,\n      bindGroupView0BaseLayer,\n      bindGroupView0LayerCount,\n      bindGroupView1BaseLevel,\n      bindGroupView1LevelCount,\n      bindGroupView1BaseLayer,\n      bindGroupView1LayerCount,\n      bindGroupAspect0,\n      bindGroupAspect1,\n      inSamePass,\n    } = t.params;\n\n    const texture = t.device.createTexture({\n      format: 'depth24plus-stencil8',\n      usage: GPUTextureUsage.TEXTURE_BINDING,\n      size: [kTextureSize, kTextureSize, kTextureLayers],\n      mipLevelCount: kTextureLevels,\n    });\n    const bindGroupView0 = texture.createView({\n      dimension: '2d-array',\n      baseArrayLayer: bindGroupView0BaseLayer,\n      arrayLayerCount: bindGroupView0LayerCount,\n      baseMipLevel: bindGroupView0BaseLevel,\n      mipLevelCount: bindGroupView0LevelCount,\n      aspect: bindGroupAspect0,\n    });\n    const bindGroupView1 = texture.createView({\n      dimension: '2d-array',\n      baseArrayLayer: bindGroupView1BaseLayer,\n      arrayLayerCount: bindGroupView1LayerCount,\n      baseMipLevel: bindGroupView1BaseLevel,\n      mipLevelCount: bindGroupView1LevelCount,\n      aspect: bindGroupAspect1,\n    });\n\n    const sampleType0 = bindGroupAspect0 === 'depth-only' ? 'depth' : 'uint';\n    const sampleType1 = bindGroupAspect1 === 'depth-only' ? 'depth' : 'uint';\n    const bindGroup0 = t.createBindGroupForTest(bindGroupView0, 'texture', sampleType0);\n    const bindGroup1 = t.createBindGroupForTest(bindGroupView1, 'texture', sampleType1);\n\n    const colorTexture = t.device.createTexture({\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n      size: [kTextureSize, kTextureSize, 1],\n      mipLevelCount: 1,\n    });\n    const colorAttachment = t.getColorAttachment(colorTexture);\n    const encoder = t.device.createCommandEncoder();\n    const renderPass = encoder.beginRenderPass({\n      colorAttachments: [colorAttachment],\n    });\n    if (inSamePass) {\n      renderPass.setBindGroup(0, bindGroup0);\n      renderPass.setBindGroup(1, bindGroup1);\n      renderPass.end();\n    } else {\n      renderPass.setBindGroup(0, bindGroup0);\n      renderPass.end();\n\n      const renderPass2 = encoder.beginRenderPass({\n        colorAttachments: [colorAttachment],\n      });\n      renderPass2.setBindGroup(1, bindGroup1);\n      renderPass2.end();\n    }\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, false);\n  });\n"],"file":"in_render_common.spec.js"}