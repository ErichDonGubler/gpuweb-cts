{"version":3,"sources":["../../../../src/webgpu/api/validation/attachment_compatibility.spec.ts"],"names":["description","makeTestGroup","range","kRegularTextureFormats","kSizedDepthStencilFormats","kUnsizedDepthStencilFormats","kTextureSampleCounts","kMaxColorAttachments","kTextureFormatInfo","ValidationTest","kColorAttachmentCounts","i","kColorAttachments","map","count","result","Array","fill","concat","r","cases","j","push","flat","kDepthStencilAttachmentFormats","undefined","F","createAttachmentTextureView","format","sampleCount","device","createTexture","size","usage","GPUTextureUsage","RENDER_ATTACHMENT","createView","createColorAttachment","view","clearValue","loadOp","storeOp","createDepthAttachment","attachment","depth","depthClearValue","depthLoadOp","depthStoreOp","stencil","stencilClearValue","stencilLoadOp","stencilStoreOp","createRenderPipeline","targets","depthStencil","vertex","module","createShaderModule","code","entryPoint","fragment","primitive","topology","multisample","g","kColorAttachmentFormats","filter","info","color","renderable","test","desc","paramsSubcasesOnly","u","combine","fn","t","passFormat","bundleFormat","params","bundleEncoder","createRenderBundleEncoder","colorFormats","bundle","finish","encoder","validateFinishAndSubmit","createEncoder","pass","beginRenderPass","colorAttachments","executeBundles","end","passCount","bundleCount","beginSubcases","p","attachmentCount","passAttachments","length","bundleAttachments","every","v","selectDeviceForTextureFormatOrSkipTestCase","depthStencilFormat","depthStencilAttachment","renderSampleCount","bundleSampleCount","encoderType","encoderFormat","pipelineFormat","pipeline","writeMask","attachmentInfo","setPipeline","encoderCount","pipelineCount","encoderAttachments","pipelineAttachments","colorTargets","attachmentType","encoderSampleCount","pipelineSampleCount"],"mappings":"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","sourcesContent":["export const description = `\nValidation for attachment compatibility between render passes, bundles, and pipelines\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { range } from '../../../common/util/util.js';\nimport {\n  kRegularTextureFormats,\n  kSizedDepthStencilFormats,\n  kUnsizedDepthStencilFormats,\n  kTextureSampleCounts,\n  kMaxColorAttachments,\n  kTextureFormatInfo,\n} from '../../capability_info.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nconst kColorAttachmentCounts = range(kMaxColorAttachments, i => i + 1);\nconst kColorAttachments = kColorAttachmentCounts\n  .map(count => {\n    // generate cases with 0..1 null attachments at different location\n    // e.g. count == 2\n    // [\n    //    [1, 1],\n    //    [0, 1],\n    //    [1, 0],\n    // ]\n    // 0 (false) means null attachment, 1 (true) means non-null attachment, at the slot\n\n    // Special cases: we need at least a color attachment, when we don't have depth stencil attachment\n    if (count === 1) {\n      return [[1]];\n    }\n    if (count === 2) {\n      return [\n        [1, 1],\n        [0, 1],\n        [1, 0],\n      ];\n    }\n\n    // [1, 1, ..., 1]: all color attachment are used\n    let result = [new Array<boolean>(count).fill(true)];\n\n    // [1, 0, 1, ..., 1]: generate cases with one null attachment at different locations\n    result = result.concat(\n      range(count, i => {\n        const r = new Array<boolean>(count).fill(true);\n        r[i] = false;\n        return r;\n      })\n    );\n\n    // [1, 0, 1, ..., 0, 1]: generate cases with two null attachments at different locations\n    // To reduce test run time, limit the attachment count to <= 4\n    if (count <= 4) {\n      result = result.concat(\n        range(count - 1, i => {\n          const cases = [] as boolean[][];\n          for (let j = i + 1; j < count; j++) {\n            const r = new Array<boolean>(count).fill(true);\n            r[i] = false;\n            r[j] = false;\n            cases.push(r);\n          }\n          return cases;\n        }).flat()\n      );\n    }\n\n    return result;\n  })\n  .flat() as boolean[][];\n\nconst kDepthStencilAttachmentFormats = [\n  undefined,\n  ...kSizedDepthStencilFormats,\n  ...kUnsizedDepthStencilFormats,\n] as const;\n\nclass F extends ValidationTest {\n  createAttachmentTextureView(format: GPUTextureFormat, sampleCount?: number) {\n    return this.device\n      .createTexture({\n        // Size matching the \"arbitrary\" size used by ValidationTest helpers.\n        size: [16, 16, 1],\n        format,\n        usage: GPUTextureUsage.RENDER_ATTACHMENT,\n        sampleCount,\n      })\n      .createView();\n  }\n\n  createColorAttachment(\n    format: GPUTextureFormat | null,\n    sampleCount?: number\n  ): GPURenderPassColorAttachment | null {\n    return format === null\n      ? null\n      : {\n          view: this.createAttachmentTextureView(format, sampleCount),\n          clearValue: [0, 0, 0, 0],\n          loadOp: 'clear',\n          storeOp: 'store',\n        };\n  }\n\n  createDepthAttachment(\n    format: GPUTextureFormat,\n    sampleCount?: number\n  ): GPURenderPassDepthStencilAttachment {\n    const attachment: GPURenderPassDepthStencilAttachment = {\n      view: this.createAttachmentTextureView(format, sampleCount),\n    };\n    if (kTextureFormatInfo[format].depth) {\n      attachment.depthClearValue = 0;\n      attachment.depthLoadOp = 'clear';\n      attachment.depthStoreOp = 'discard';\n    }\n    if (kTextureFormatInfo[format].stencil) {\n      attachment.stencilClearValue = 1;\n      attachment.stencilLoadOp = 'clear';\n      attachment.stencilStoreOp = 'discard';\n    }\n    return attachment;\n  }\n\n  createRenderPipeline(\n    targets: Iterable<GPUColorTargetState | null>,\n    depthStencil?: GPUDepthStencilState,\n    sampleCount?: number\n  ) {\n    return this.device.createRenderPipeline({\n      vertex: {\n        module: this.device.createShaderModule({\n          code: `\n            @stage(vertex) fn main() -> @builtin(position) vec4<f32> {\n              return vec4<f32>(0.0, 0.0, 0.0, 0.0);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: this.device.createShaderModule({\n          code: '@stage(fragment) fn main() {}',\n        }),\n        entryPoint: 'main',\n        targets,\n      },\n      primitive: { topology: 'triangle-list' },\n      depthStencil,\n      multisample: { count: sampleCount },\n    });\n  }\n}\n\nexport const g = makeTestGroup(F);\n\nconst kColorAttachmentFormats = kRegularTextureFormats.filter(format => {\n  const info = kTextureFormatInfo[format];\n  return info.color && info.renderable;\n});\n\ng.test('render_pass_and_bundle,color_format')\n  .desc('Test that color attachment formats in render passes and bundles must match.')\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('passFormat', kColorAttachmentFormats)\n      .combine('bundleFormat', kColorAttachmentFormats)\n  )\n  .fn(t => {\n    const { passFormat, bundleFormat } = t.params;\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: [bundleFormat],\n    });\n    const bundle = bundleEncoder.finish();\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder('non-pass');\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [t.createColorAttachment(passFormat)],\n    });\n    pass.executeBundles([bundle]);\n    pass.end();\n    validateFinishAndSubmit(passFormat === bundleFormat, true);\n  });\n\ng.test('render_pass_and_bundle,color_count')\n  .desc(\n    `\n  Test that the number of color attachments in render passes and bundles must match.\n  `\n  )\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('passCount', kColorAttachmentCounts)\n      .combine('bundleCount', kColorAttachmentCounts)\n  )\n  .fn(t => {\n    const { passCount, bundleCount } = t.params;\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: range(bundleCount, () => 'rgba8unorm'),\n    });\n    const bundle = bundleEncoder.finish();\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder('non-pass');\n    const pass = encoder.beginRenderPass({\n      colorAttachments: range(passCount, () => t.createColorAttachment('rgba8unorm')),\n    });\n    pass.executeBundles([bundle]);\n    pass.end();\n    validateFinishAndSubmit(passCount === bundleCount, true);\n  });\n\ng.test('render_pass_and_bundle,color_sparse')\n  .desc(\n    `\n  Test that each of color attachments in render passes and bundles must match.\n  `\n  )\n  .params(u =>\n    u //\n      // introduce attachmentCount to make it easier to split the test\n      .combine('attachmentCount', kColorAttachmentCounts)\n      .beginSubcases()\n      .combine('passAttachments', kColorAttachments)\n      .combine('bundleAttachments', kColorAttachments)\n      .filter(\n        p =>\n          p.attachmentCount === p.passAttachments.length &&\n          p.attachmentCount === p.bundleAttachments.length\n      )\n  )\n  .fn(t => {\n    const { passAttachments, bundleAttachments } = t.params;\n    const colorFormats = bundleAttachments.map(i => (i ? 'rgba8unorm' : null));\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats,\n    });\n    const bundle = bundleEncoder.finish();\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder('non-pass');\n    const colorAttachments = passAttachments.map(i =>\n      t.createColorAttachment(i ? 'rgba8unorm' : null)\n    );\n    const pass = encoder.beginRenderPass({\n      colorAttachments,\n    });\n    pass.executeBundles([bundle]);\n    pass.end();\n    validateFinishAndSubmit(\n      passAttachments.every((v, i) => v === bundleAttachments[i]),\n      true\n    );\n  });\n\ng.test('render_pass_and_bundle,depth_format')\n  .desc('Test that the depth attachment format in render passes and bundles must match.')\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('passFormat', kDepthStencilAttachmentFormats)\n      .combine('bundleFormat', kDepthStencilAttachmentFormats)\n  )\n  .fn(async t => {\n    const { passFormat, bundleFormat } = t.params;\n    await t.selectDeviceForTextureFormatOrSkipTestCase([passFormat, bundleFormat]);\n\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: ['rgba8unorm'],\n      depthStencilFormat: bundleFormat,\n    });\n    const bundle = bundleEncoder.finish();\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder('non-pass');\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [t.createColorAttachment('rgba8unorm')],\n      depthStencilAttachment:\n        passFormat !== undefined ? t.createDepthAttachment(passFormat) : undefined,\n    });\n    pass.executeBundles([bundle]);\n    pass.end();\n    validateFinishAndSubmit(passFormat === bundleFormat, true);\n  });\n\ng.test('render_pass_and_bundle,sample_count')\n  .desc('Test that the sample count in render passes and bundles must match.')\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('renderSampleCount', kTextureSampleCounts)\n      .combine('bundleSampleCount', kTextureSampleCounts)\n  )\n  .fn(t => {\n    const { renderSampleCount, bundleSampleCount } = t.params;\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: ['rgba8unorm'],\n      sampleCount: bundleSampleCount,\n    });\n    const bundle = bundleEncoder.finish();\n    const { encoder, validateFinishAndSubmit } = t.createEncoder('non-pass');\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [t.createColorAttachment('rgba8unorm', renderSampleCount)],\n    });\n    pass.executeBundles([bundle]);\n    pass.end();\n    validateFinishAndSubmit(renderSampleCount === bundleSampleCount, true);\n  });\n\ng.test('render_pass_or_bundle_and_pipeline,color_format')\n  .desc(\n    `\nTest that color attachment formats in render passes or bundles match the pipeline color format.\n`\n  )\n  .params(u =>\n    u\n      .combine('encoderType', ['render pass', 'render bundle'] as const)\n      .beginSubcases()\n      .combine('encoderFormat', kColorAttachmentFormats)\n      .combine('pipelineFormat', kColorAttachmentFormats)\n  )\n  .fn(t => {\n    const { encoderType, encoderFormat, pipelineFormat } = t.params;\n    const pipeline = t.createRenderPipeline([{ format: pipelineFormat, writeMask: 0 }]);\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder(encoderType, {\n      attachmentInfo: { colorFormats: [encoderFormat] },\n    });\n    encoder.setPipeline(pipeline);\n    validateFinishAndSubmit(encoderFormat === pipelineFormat, true);\n  });\n\ng.test('render_pass_or_bundle_and_pipeline,color_count')\n  .desc(\n    `\nTest that the number of color attachments in render passes or bundles match the pipeline color\ncount.\n`\n  )\n  .params(u =>\n    u\n      .combine('encoderType', ['render pass', 'render bundle'] as const)\n      .beginSubcases()\n      .combine('encoderCount', kColorAttachmentCounts)\n      .combine('pipelineCount', kColorAttachmentCounts)\n  )\n  .fn(t => {\n    const { encoderType, encoderCount, pipelineCount } = t.params;\n    const pipeline = t.createRenderPipeline(\n      range(pipelineCount, () => ({ format: 'rgba8unorm', writeMask: 0 }))\n    );\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder(encoderType, {\n      attachmentInfo: { colorFormats: range(encoderCount, () => 'rgba8unorm') },\n    });\n    encoder.setPipeline(pipeline);\n    validateFinishAndSubmit(encoderCount === pipelineCount, true);\n  });\n\ng.test('render_pass_or_bundle_and_pipeline,color_sparse')\n  .desc(\n    `\nTest that each of color attachments in render passes or bundles match that of the pipeline.\n`\n  )\n  .params(u =>\n    u\n      .combine('encoderType', ['render pass', 'render bundle'] as const)\n      // introduce attachmentCount to make it easier to split the test\n      .combine('attachmentCount', kColorAttachmentCounts)\n      .beginSubcases()\n      .combine('encoderAttachments', kColorAttachments)\n      .combine('pipelineAttachments', kColorAttachments)\n      .filter(\n        p =>\n          p.attachmentCount === p.encoderAttachments.length &&\n          p.attachmentCount === p.pipelineAttachments.length\n      )\n  )\n  .fn(t => {\n    const { encoderType, encoderAttachments, pipelineAttachments } = t.params;\n\n    const colorTargets = pipelineAttachments.map(i =>\n      i ? ({ format: 'rgba8unorm', writeMask: 0 } as GPUColorTargetState) : null\n    );\n    const pipeline = t.createRenderPipeline(colorTargets);\n\n    const colorFormats = encoderAttachments.map(i => (i ? 'rgba8unorm' : null));\n    const { encoder, validateFinishAndSubmit } = t.createEncoder(encoderType, {\n      attachmentInfo: { colorFormats },\n    });\n    encoder.setPipeline(pipeline);\n    validateFinishAndSubmit(\n      encoderAttachments.every((v, i) => v === pipelineAttachments[i]),\n      true\n    );\n  });\n\ng.test('render_pass_or_bundle_and_pipeline,depth_format')\n  .desc(\n    `\nTest that the depth attachment format in render passes or bundles match the pipeline depth format.\n`\n  )\n  .params(u =>\n    u\n      .combine('encoderType', ['render pass', 'render bundle'] as const)\n      .beginSubcases()\n      .combine('encoderFormat', kDepthStencilAttachmentFormats)\n      .combine('pipelineFormat', kDepthStencilAttachmentFormats)\n  )\n  .fn(async t => {\n    const { encoderType, encoderFormat, pipelineFormat } = t.params;\n    await t.selectDeviceForTextureFormatOrSkipTestCase([encoderFormat, pipelineFormat]);\n\n    const pipeline = t.createRenderPipeline(\n      [{ format: 'rgba8unorm', writeMask: 0 }],\n      pipelineFormat !== undefined ? { format: pipelineFormat } : undefined\n    );\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder(encoderType, {\n      attachmentInfo: { colorFormats: ['rgba8unorm'], depthStencilFormat: encoderFormat },\n    });\n    encoder.setPipeline(pipeline);\n    validateFinishAndSubmit(encoderFormat === pipelineFormat, true);\n  });\n\ng.test('render_pass_or_bundle_and_pipeline,sample_count')\n  .desc(\n    `\nTest that the sample count in render passes or bundles match the pipeline sample count for both color texture and depthstencil texture.\n`\n  )\n  .params(u =>\n    u\n      .combine('encoderType', ['render pass', 'render bundle'] as const)\n      .combine('attachmentType', ['color', 'depthstencil'] as const)\n      .beginSubcases()\n      .combine('encoderSampleCount', kTextureSampleCounts)\n      .combine('pipelineSampleCount', kTextureSampleCounts)\n  )\n  .fn(t => {\n    const { encoderType, attachmentType, encoderSampleCount, pipelineSampleCount } = t.params;\n\n    const colorFormats = attachmentType === 'color' ? ['rgba8unorm' as const] : [];\n    const depthStencilFormat =\n      attachmentType === 'depthstencil' ? ('depth24plus-stencil8' as const) : undefined;\n\n    const pipeline = t.createRenderPipeline(\n      colorFormats.map(format => ({ format, writeMask: 0 })),\n      depthStencilFormat ? { format: depthStencilFormat } : undefined,\n      pipelineSampleCount\n    );\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder(encoderType, {\n      attachmentInfo: { colorFormats, depthStencilFormat, sampleCount: encoderSampleCount },\n    });\n    encoder.setPipeline(pipeline);\n    validateFinishAndSubmit(encoderSampleCount === pipelineSampleCount, true);\n  });\n"],"file":"attachment_compatibility.spec.js"}