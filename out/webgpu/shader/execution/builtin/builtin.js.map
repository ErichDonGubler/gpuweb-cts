{"version":3,"sources":["../../../../../src/webgpu/shader/execution/builtin/builtin.ts"],"names":["Colors","ScalarType","Scalar","Vector","TypeVec","TypeU32","VectorType","diffULP","absThreshold","diff","got","expected","Number","isFinite","Math","abs","ulpThreshold","ulp","compare","cmpFloats","gTy","type","eTy","matched","red","toString","g","e","isFloat","kind","value","green","gLen","elements","length","eLen","gElements","Array","eElements","i","max","cmp","join","Error","anyOf","values","failed","push","toComparator","input","undefined","storageType","ty","width","elementType","fromStorage","expr","toStorage","run","t","builtin","parameterTypes","returnType","cfg","storageClass","cases","expect","vectorize","packed","packScalarsToVector","kValueStride","paramExpr","map","source","inputData","Uint8Array","caseStride","caseIdx","caseBase","paramIdx","offset","params","copyTo","inputBuffer","makeBufferWithContents","GPUBufferUsage","COPY_SRC","UNIFORM","STORAGE","outputBufferSize","outputBuffer","device","createBuffer","size","usage","COPY_DST","module","createShaderModule","code","pipeline","createComputePipeline","compute","entryPoint","group","createBindGroup","layout","getBindGroupLayout","entries","binding","resource","buffer","encoder","createCommandEncoder","pass","beginComputePass","setPipeline","setBindGroup","dispatch","endPass","queue","submit","finish","checkExpectation","outputData","outputs","read","errs","c","expectGPUBufferValuesPassCheck","typedLength","vectorWidth","packedCases","packedParameterTypes","p","packedReturnType","clampCaseIdx","idx","min","packedInputs","inputElements","comparators","packedComparator","d","kBit","i32","positive","negative","u32","f32","zero","subnormal","nan","s","q","infinity","powTwo","toMinus1","toMinus2","toMinus3","toMinus4","toMinus5","toMinus6","toMinus7","toMinus8","toMinus9","toMinus10","toMinus11","toMinus12","toMinus13","toMinus14","toMinus15","toMinus16","toMinus17","toMinus18","toMinus19","toMinus20","toMinus21","toMinus22","toMinus23","toMinus24","toMinus25","toMinus26","toMinus27","toMinus28","toMinus29","toMinus30","toMinus31","to0","to1","to2","to3","to4","to5","to6","to7","to8","to9","to10","to11","to12","to13","to14","to15","to16","to17","to18","to19","to20","to21","to22","to23","to24","to25","to26","to27","to28","to29","to30","to31","negPowTwo","kValue","pow","to32","toMinus32"],"mappings":"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","sourcesContent":["import { Colors } from '../../../../common/util/colors.js';\nimport { GPUTest } from '../../../gpu_test.js';\nimport {\n  ScalarType,\n  Scalar,\n  Vector,\n  Value,\n  Type,\n  TypeVec,\n  TypeU32,\n  VectorType,\n} from '../../../util/conversion.js';\nimport { diffULP } from '../../../util/math.js';\n\n/** Comparison describes the result of a Comparator function. */\nexport interface Comparison {\n  matched: boolean; // True if the two values were considered a match\n  got: string; // The string representation of the 'got' value (possibly with markup)\n  expected: string; // The string representation of the 'expected' value (possibly with markup)\n}\n\n/** FloatMatch is a function that compares whether the two floating point numbers match. */\nexport interface FloatMatch {\n  (got: number, expected: number): boolean;\n}\n\n/** Comparator is a function that compares whether the provided value matches an expectation. */\nexport interface Comparator {\n  (got: Value, cmpFloats: FloatMatch): Comparison;\n}\n\n/**\n * @returns a FloatMatch that returns true iff the two numbers are equal to, or\n * less than the specified absolute error threshold.\n */\nexport function absThreshold(diff: number): FloatMatch {\n  return (got, expected) => {\n    if (got === expected) {\n      return true;\n    }\n    if (!Number.isFinite(got) || !Number.isFinite(expected)) {\n      return false;\n    }\n    return Math.abs(got - expected) <= diff;\n  };\n}\n\n/**\n * @returns a FloatMatch that returns true iff the two numbers are within or\n * equal to the specified ULP threshold value.\n */\nexport function ulpThreshold(ulp: number): FloatMatch {\n  return (got, expected) => {\n    if (got === expected) {\n      return true;\n    }\n    return diffULP(got, expected) <= ulp;\n  };\n}\n\n// compare() compares 'got' to 'expected', returning the Comparison information.\nfunction compare(got: Value, expected: Value, cmpFloats: FloatMatch): Comparison {\n  {\n    // Check types\n    const gTy = got.type;\n    const eTy = expected.type;\n    if (gTy !== eTy) {\n      return {\n        matched: false,\n        got: `${Colors.red(gTy.toString())}(${got})`,\n        expected: `${Colors.red(eTy.toString())}(${expected})`,\n      };\n    }\n  }\n\n  if (got instanceof Scalar) {\n    const g = got;\n    const e = expected as Scalar;\n    const isFloat = g.type.kind === 'f32';\n    const matched =\n      (isFloat && cmpFloats(g.value as number, e.value as number)) ||\n      (!isFloat && g.value === e.value);\n    return {\n      matched,\n      got: g.toString(),\n      expected: matched ? Colors.green(e.toString()) : Colors.red(e.toString()),\n    };\n  }\n  if (got instanceof Vector) {\n    const gLen = got.elements.length;\n    const eLen = (expected as Vector).elements.length;\n    let matched = gLen === eLen;\n    const gElements = new Array<string>(gLen);\n    const eElements = new Array<string>(eLen);\n    for (let i = 0; i < Math.max(gLen, eLen); i++) {\n      if (i < gLen && i < eLen) {\n        const g = got.elements[i];\n        const e = (expected as Vector).elements[i];\n        const cmp = compare(g, e, cmpFloats);\n        matched = matched && cmp.matched;\n        gElements[i] = cmp.got;\n        eElements[i] = cmp.expected;\n        continue;\n      }\n      matched = false;\n      if (i < gLen) {\n        gElements[i] = got.elements[i].toString();\n      }\n      if (i < eLen) {\n        eElements[i] = (expected as Vector).elements[i].toString();\n      }\n    }\n    return {\n      matched,\n      got: `${got.type}(${gElements.join(', ')})`,\n      expected: `${expected.type}(${eElements.join(', ')})`,\n    };\n  }\n  throw new Error(`unhandled type '${typeof got}`);\n}\n\n/** @returns a Comparator that checks whether a test value matches any of the provided values */\nexport function anyOf(...values: Value[]): Comparator {\n  return (got, cmpFloats) => {\n    const failed: Array<string> = [];\n    for (const e of values) {\n      const cmp = compare(got, e, cmpFloats);\n      if (cmp.matched) {\n        return cmp;\n      }\n      failed.push(cmp.expected);\n    }\n    return { matched: false, got: got.toString(), expected: failed.join(' or ') };\n  };\n}\n\n// Helper for converting Values to Comparators.\nfunction toComparator(input: Value | Comparator): Comparator {\n  if ((input as Value).type !== undefined) {\n    return (got, cmpFloats) => compare(got, input as Value, cmpFloats);\n  }\n  return input as Comparator;\n}\n\n/** Case is a single builtin test case. */\nexport type Case = {\n  // The input value to the builtin\n  input: Value | Array<Value>;\n  // The expected value, or comparator\n  expected: Value | Comparator;\n};\n\n/** CaseList is a list of Cases */\nexport type CaseList = Array<Case>;\n\n/** Configuration for running a builtin test */\nexport type Config = {\n  // Where the input values are read from\n  storageClass: 'uniform' | 'storage_r' | 'storage_rw';\n  // If defined, scalar test cases will be packed into vectors of the given width.\n  // Requires that all parameters of the builtin overload are of a scalar type,\n  // and the return type of the builtin overload is also a scalar type.\n  // If the number of test cases is not a multiple of the vector width, then the\n  // last scalar value is repeated to fill the last vector value.\n  vectorize?: number;\n  // The FloatMatch to use when comparing floating point numbers.\n  // If undefined, floating point numbers must match exactly.\n  cmpFloats?: FloatMatch;\n};\n\n// Helper for returning the WGSL storage type for the given Type.\nfunction storageType(ty: Type): Type {\n  if (ty instanceof ScalarType) {\n    if (ty.kind === 'bool') {\n      return TypeU32;\n    }\n  }\n  if (ty instanceof VectorType) {\n    return TypeVec(ty.width, storageType(ty.elementType) as ScalarType);\n  }\n  return ty;\n}\n\n// Helper for converting a value of the type 'ty' from the storage type.\nfunction fromStorage(ty: Type, expr: string): string {\n  if (ty instanceof ScalarType) {\n    if (ty.kind === 'bool') {\n      return `${expr} != 0u`;\n    }\n  }\n  if (ty instanceof VectorType) {\n    if (ty.elementType.kind === 'bool') {\n      return `${expr} != vec${ty.width}<u32>(0u)`;\n    }\n  }\n  return expr;\n}\n\n// Helper for converting a value of the type 'ty' to the storage type.\nfunction toStorage(ty: Type, expr: string): string {\n  if (ty instanceof ScalarType) {\n    if (ty.kind === 'bool') {\n      return `select(0u, 1u, ${expr})`;\n    }\n  }\n  if (ty instanceof VectorType) {\n    if (ty.elementType.kind === 'bool') {\n      return `select(vec${ty.width}<u32>(0u), vec${ty.width}<u32>(0u), ${expr})`;\n    }\n  }\n  return expr;\n}\n\n/**\n * Runs a builtin test\n * @param t the GPUTest\n * @param builtin the builtin being tested\n * @param parameterTypes the list of builtin parameter types\n * @param returnType the return type for the builtin overload\n * @param cfg test configuration values\n * @param cases list of test cases\n */\nexport function run(\n  t: GPUTest,\n  builtin: string,\n  parameterTypes: Array<Type>,\n  returnType: Type,\n  cfg: Config = { storageClass: 'storage_r' },\n  cases: CaseList\n) {\n  const cmpFloats =\n    cfg.cmpFloats !== undefined ? cfg.cmpFloats : (got: number, expect: number) => got === expect;\n\n  // If the 'vectorize' config option was provided, pack the cases into vectors.\n  if (cfg.vectorize !== undefined) {\n    const packed = packScalarsToVector(parameterTypes, returnType, cases, cfg.vectorize, cmpFloats);\n    cases = packed.cases;\n    parameterTypes = packed.parameterTypes;\n    returnType = packed.returnType;\n  }\n\n  // Currently all values are packed into buffers of 16 byte strides\n  const kValueStride = 16;\n\n  // returns the WGSL expression to load the ith parameter of the given type from the input buffer\n  const paramExpr = (ty: Type, i: number) => fromStorage(ty, `inputs.test[i].param${i}`);\n\n  // resolves to the expression that calls the builtin\n  const expr = toStorage(\n    returnType,\n    builtin + '(' + parameterTypes.map(paramExpr).join(', ') + ')'\n  );\n\n  // the full WGSL shader source\n  const source = `\nstruct Parameters {\n${parameterTypes\n  .map((ty, i) => `  [[size(${kValueStride})]] param${i} : ${storageType(ty)};`)\n  .join('\\n')}\n};\n\n[[block]]\nstruct Inputs {\n  test : array<Parameters, ${cases.length}>;\n};\n\n[[block]]\nstruct Outputs {\n  test : [[stride(${kValueStride})]] array<${storageType(returnType)}, ${cases.length}>;\n};\n\n${\n  cfg.storageClass === 'uniform'\n    ? `[[group(0), binding(0)]] var<uniform> inputs : Inputs;`\n    : `[[group(0), binding(0)]] var<storage, ${\n        cfg.storageClass === 'storage_r' ? 'read' : 'read_write'\n      }> inputs : Inputs;`\n}\n[[group(0), binding(1)]] var<storage, write> outputs : Outputs;\n\n[[stage(compute), workgroup_size(1)]]\nfn main() {\n  for(var i = 0; i < ${cases.length}; i = i + 1) {\n    outputs.test[i] = ${expr};\n  }\n}\n`;\n\n  // Holds all the parameter values for all cases\n  const inputData = new Uint8Array(cases.length * parameterTypes.length * kValueStride);\n\n  // Pack all the input parameter values into the inputData buffer\n  {\n    const caseStride = kValueStride * parameterTypes.length;\n    for (let caseIdx = 0; caseIdx < cases.length; caseIdx++) {\n      const caseBase = caseIdx * caseStride;\n      for (let paramIdx = 0; paramIdx < parameterTypes.length; paramIdx++) {\n        const offset = caseBase + paramIdx * kValueStride;\n        const params = cases[caseIdx].input;\n        if (params instanceof Array) {\n          params[paramIdx].copyTo(inputData, offset);\n        } else {\n          params.copyTo(inputData, offset);\n        }\n      }\n    }\n  }\n  const inputBuffer = t.makeBufferWithContents(\n    inputData,\n    GPUBufferUsage.COPY_SRC |\n      (cfg.storageClass === 'uniform' ? GPUBufferUsage.UNIFORM : GPUBufferUsage.STORAGE)\n  );\n\n  // Construct a buffer to hold the results of the builtin tests\n  const outputBufferSize = cases.length * kValueStride;\n  const outputBuffer = t.device.createBuffer({\n    size: outputBufferSize,\n    usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST | GPUBufferUsage.STORAGE,\n  });\n\n  const module = t.device.createShaderModule({ code: source });\n  const pipeline = t.device.createComputePipeline({\n    compute: { module, entryPoint: 'main' },\n  });\n\n  const group = t.device.createBindGroup({\n    layout: pipeline.getBindGroupLayout(0),\n    entries: [\n      { binding: 0, resource: { buffer: inputBuffer } },\n      { binding: 1, resource: { buffer: outputBuffer } },\n    ],\n  });\n\n  const encoder = t.device.createCommandEncoder();\n  const pass = encoder.beginComputePass();\n  pass.setPipeline(pipeline);\n  pass.setBindGroup(0, group);\n  pass.dispatch(1);\n  pass.endPass();\n\n  t.queue.submit([encoder.finish()]);\n\n  const checkExpectation = (outputData: Uint8Array) => {\n    // Read the outputs from the output buffer\n    const outputs = new Array<Value>(cases.length);\n    for (let i = 0; i < cases.length; i++) {\n      outputs[i] = returnType.read(outputData, i * kValueStride);\n    }\n\n    // The list of expectation failures\n    const errs: string[] = [];\n\n    // For each case...\n    for (let caseIdx = 0; caseIdx < cases.length; caseIdx++) {\n      const c = cases[caseIdx];\n      const got = outputs[caseIdx];\n      const cmp = toComparator(c.expected)(got, cmpFloats);\n      if (!cmp.matched) {\n        errs.push(`${builtin}(${c.input instanceof Array ? c.input.join(', ') : c.input})\n    returned: ${cmp.got}\n    expected: ${cmp.expected}`);\n      }\n    }\n\n    return errs.length > 0 ? new Error(errs.join('\\n\\n')) : undefined;\n  };\n\n  t.expectGPUBufferValuesPassCheck(outputBuffer, checkExpectation, {\n    type: Uint8Array,\n    typedLength: outputBufferSize,\n  });\n}\n\n/**\n * Packs a list of scalar test cases into a smaller list of vector cases.\n * Requires that all parameters of the builtin overload are of a scalar type,\n * and the return type of the builtin overload is also a scalar type.\n * If `cases.length` is not a multiple of `vectorWidth`, then the last scalar\n * test case value is repeated to fill the vector value.\n */\nfunction packScalarsToVector(\n  parameterTypes: Array<Type>,\n  returnType: Type,\n  cases: CaseList,\n  vectorWidth: number,\n  cmpFloats: FloatMatch\n): { cases: CaseList; parameterTypes: Array<Type>; returnType: Type } {\n  // Validate that the parameters and return type are all vectorizable\n  for (let i = 0; i < parameterTypes.length; i++) {\n    const ty = parameterTypes[i];\n    if (!(ty instanceof ScalarType)) {\n      throw new Error(\n        `packScalarsToVector() can only be used on scalar parameter types, but the ${i}'th parameter type is a ${ty}'`\n      );\n    }\n  }\n  if (!(returnType instanceof ScalarType)) {\n    throw new Error(\n      `packScalarsToVector() can only be used with a scalar return type, but the return type is a ${returnType}'`\n    );\n  }\n\n  const packedCases: Array<Case> = [];\n  const packedParameterTypes = parameterTypes.map(p => TypeVec(vectorWidth, p as ScalarType));\n  const packedReturnType = new VectorType(vectorWidth, returnType as ScalarType);\n\n  const clampCaseIdx = (idx: number) => Math.min(idx, cases.length - 1);\n\n  let caseIdx = 0;\n  while (caseIdx < cases.length) {\n    // Construct the vectorized inputs from the scalar cases\n    const packedInputs = new Array<Vector>(parameterTypes.length);\n    for (let paramIdx = 0; paramIdx < parameterTypes.length; paramIdx++) {\n      const inputElements = new Array<Scalar>(vectorWidth);\n      for (let i = 0; i < vectorWidth; i++) {\n        const input = cases[clampCaseIdx(caseIdx + i)].input;\n        inputElements[i] = (input instanceof Array ? input[paramIdx] : input) as Scalar;\n      }\n      packedInputs[paramIdx] = new Vector(inputElements);\n    }\n\n    // Gather the comparators for the packed cases\n    const comparators = new Array<Comparator>(vectorWidth);\n    for (let i = 0; i < vectorWidth; i++) {\n      comparators[i] = toComparator(cases[clampCaseIdx(caseIdx + i)].expected);\n    }\n    const packedComparator = (got: Value) => {\n      let matched = true;\n      const gElements = new Array<string>(vectorWidth);\n      const eElements = new Array<string>(vectorWidth);\n      for (let i = 0; i < vectorWidth; i++) {\n        const d = comparators[i]((got as Vector).elements[i], cmpFloats);\n        matched = matched && d.matched;\n        gElements[i] = d.got;\n        eElements[i] = d.expected;\n      }\n      return {\n        matched,\n        got: `${packedReturnType}(${gElements.join(', ')})`,\n        expected: `${packedReturnType}(${eElements.join(', ')})`,\n      };\n    };\n\n    // Append the new packed case\n    packedCases.push({ input: packedInputs, expected: packedComparator });\n    caseIdx += vectorWidth;\n  }\n\n  return {\n    cases: packedCases,\n    parameterTypes: packedParameterTypes,\n    returnType: packedReturnType,\n  };\n}\n\n// TODO(sarahM0): Perhaps instead of kBit and kValue tables we could have one table\n// where every value is a Scalar instead of either bits or value?\n// Then tests wouldn't need most of the Scalar.fromX calls,\n// and you would probably need fewer table entries in total\n// (since each Scalar has both bits and value).\nexport const kBit = {\n  // Limits of int32\n  i32: {\n    positive: {\n      min: 0x0000_0000, // 0\n      max: 0x7fff_ffff, // 2147483647\n    },\n    negative: {\n      min: 0x8000_0000, // -2147483648\n      max: 0x0000_0000, // 0\n    },\n  },\n\n  // Limits of uint32\n  u32: {\n    min: 0x0000_0000,\n    max: 0xffff_ffff,\n  },\n\n  // Limits of f32\n  f32: {\n    positive: {\n      min: 0x0080_0000,\n      max: 0x7f7f_ffff,\n      zero: 0x0000_0000,\n    },\n    negative: {\n      max: 0x8080_0000,\n      min: 0xff7f_ffff,\n      zero: 0x8000_0000,\n    },\n    subnormal: {\n      positive: {\n        min: 0x0000_0001,\n        max: 0x007f_ffff,\n      },\n    },\n    nan: {\n      negative: {\n        s: 0xff80_0001,\n        q: 0xffc0_0001,\n      },\n      positive: {\n        s: 0x7f80_0001,\n        q: 0x7fc0_0001,\n      },\n    },\n    infinity: {\n      positive: 0x7f80_0000,\n      negative: 0xff80_0000,\n    },\n  },\n\n  // 32-bit representation of power(2, n) n = {-31, ..., 31}\n  // A uint32 representation as a JS `number`\n  // {toMinus31, ..., to31} ie. {-31, ..., 31}\n  powTwo: {\n    toMinus1: 0x3f00_0000,\n    toMinus2: 0x3e80_0000,\n    toMinus3: 0x3e00_0000,\n    toMinus4: 0x3d80_0000,\n    toMinus5: 0x3d00_0000,\n    toMinus6: 0x3c80_0000,\n    toMinus7: 0x3c00_0000,\n    toMinus8: 0x3b80_0000,\n    toMinus9: 0x3b00_0000,\n    toMinus10: 0x3a80_0000,\n    toMinus11: 0x3a00_0000,\n    toMinus12: 0x3980_0000,\n    toMinus13: 0x3900_0000,\n    toMinus14: 0x3880_0000,\n    toMinus15: 0x3800_0000,\n    toMinus16: 0x3780_0000,\n    toMinus17: 0x3700_0000,\n    toMinus18: 0x3680_0000,\n    toMinus19: 0x3600_0000,\n    toMinus20: 0x3580_0000,\n    toMinus21: 0x3500_0000,\n    toMinus22: 0x3480_0000,\n    toMinus23: 0x3400_0000,\n    toMinus24: 0x3380_0000,\n    toMinus25: 0x3300_0000,\n    toMinus26: 0x3280_0000,\n    toMinus27: 0x3200_0000,\n    toMinus28: 0x3180_0000,\n    toMinus29: 0x3100_0000,\n    toMinus30: 0x3080_0000,\n    toMinus31: 0x3000_0000,\n\n    to0: 0x0000_0001,\n    to1: 0x0000_0002,\n    to2: 0x0000_0004,\n    to3: 0x0000_0008,\n    to4: 0x0000_0010,\n    to5: 0x0000_0020,\n    to6: 0x0000_0040,\n    to7: 0x0000_0080,\n    to8: 0x0000_0100,\n    to9: 0x0000_0200,\n    to10: 0x0000_0400,\n    to11: 0x0000_0800,\n    to12: 0x0000_1000,\n    to13: 0x0000_2000,\n    to14: 0x0000_4000,\n    to15: 0x0000_8000,\n    to16: 0x0001_0000,\n    to17: 0x0002_0000,\n    to18: 0x0004_0000,\n    to19: 0x0008_0000,\n    to20: 0x0010_0000,\n    to21: 0x0020_0000,\n    to22: 0x0040_0000,\n    to23: 0x0080_0000,\n    to24: 0x0100_0000,\n    to25: 0x0200_0000,\n    to26: 0x0400_0000,\n    to27: 0x0800_0000,\n    to28: 0x1000_0000,\n    to29: 0x2000_0000,\n    to30: 0x4000_0000,\n    to31: 0x8000_0000,\n  },\n\n  // 32-bit representation of  of -1 * power(2, n) n = {-31, ..., 31}\n  // An int32 represented as a JS `number`\n  // {toMinus31, ..., to31} ie. {-31, ..., 31}\n  negPowTwo: {\n    toMinus1: 0xbf00_0000,\n    toMinus2: 0xbe80_0000,\n    toMinus3: 0xbe00_0000,\n    toMinus4: 0xbd80_0000,\n    toMinus5: 0xbd00_0000,\n    toMinus6: 0xbc80_0000,\n    toMinus7: 0xbc00_0000,\n    toMinus8: 0xbb80_0000,\n    toMinus9: 0xbb00_0000,\n    toMinus10: 0xba80_0000,\n    toMinus11: 0xba00_0000,\n    toMinus12: 0xb980_0000,\n    toMinus13: 0xb900_0000,\n    toMinus14: 0xb880_0000,\n    toMinus15: 0xb800_0000,\n    toMinus16: 0xb780_0000,\n    toMinus17: 0xb700_0000,\n    toMinus18: 0xb680_0000,\n    toMinus19: 0xb600_0000,\n    toMinus20: 0xb580_0000,\n    toMinus21: 0xb500_0000,\n    toMinus22: 0xb480_0000,\n    toMinus23: 0xb400_0000,\n    toMinus24: 0xb380_0000,\n    toMinus25: 0xb300_0000,\n    toMinus26: 0xb280_0000,\n    toMinus27: 0xb200_0000,\n    toMinus28: 0xb180_0000,\n    toMinus29: 0xb100_0000,\n    toMinus30: 0xb080_0000,\n    toMinus31: 0xb000_0000,\n\n    to0: 0xffff_ffff,\n    to1: 0xffff_fffe,\n    to2: 0xffff_fffc,\n    to3: 0xffff_fff8,\n    to4: 0xffff_fff0,\n    to5: 0xffff_ffe0,\n    to6: 0xffff_ffc0,\n    to7: 0xffff_ff80,\n    to8: 0xffff_ff00,\n    to9: 0xffff_fe00,\n    to10: 0xffff_fc00,\n    to11: 0xffff_f800,\n    to12: 0xffff_f000,\n    to13: 0xffff_e000,\n    to14: 0xffff_c000,\n    to15: 0xffff_8000,\n    to16: 0xffff_0000,\n    to17: 0xfffe_0000,\n    to18: 0xfffc_0000,\n    to19: 0xfff8_0000,\n    to20: 0xfff0_0000,\n    to21: 0xffe0_0000,\n    to22: 0xffc0_0000,\n    to23: 0xff80_0000,\n    to24: 0xff00_0000,\n    to25: 0xfe00_0000,\n    to26: 0xfc00_0000,\n    to27: 0xf800_0000,\n    to28: 0xf000_0000,\n    to29: 0xe000_0000,\n    to30: 0xc000_0000,\n    to31: 0x8000_0000,\n  },\n} as const;\n\nexport const kValue = {\n  powTwo: {\n    to0: Math.pow(2, 0),\n    to1: Math.pow(2, 1),\n    to2: Math.pow(2, 2),\n    to3: Math.pow(2, 3),\n    to4: Math.pow(2, 4),\n    to5: Math.pow(2, 5),\n    to6: Math.pow(2, 6),\n    to7: Math.pow(2, 7),\n    to8: Math.pow(2, 8),\n    to9: Math.pow(2, 9),\n    to10: Math.pow(2, 10),\n    to11: Math.pow(2, 11),\n    to12: Math.pow(2, 12),\n    to13: Math.pow(2, 13),\n    to14: Math.pow(2, 14),\n    to15: Math.pow(2, 15),\n    to16: Math.pow(2, 16),\n    to17: Math.pow(2, 17),\n    to18: Math.pow(2, 18),\n    to19: Math.pow(2, 19),\n    to20: Math.pow(2, 20),\n    to21: Math.pow(2, 21),\n    to22: Math.pow(2, 22),\n    to23: Math.pow(2, 23),\n    to24: Math.pow(2, 24),\n    to25: Math.pow(2, 25),\n    to26: Math.pow(2, 26),\n    to27: Math.pow(2, 27),\n    to28: Math.pow(2, 28),\n    to29: Math.pow(2, 29),\n    to30: Math.pow(2, 30),\n    to31: Math.pow(2, 31),\n    to32: Math.pow(2, 32),\n\n    toMinus1: Math.pow(2, -1),\n    toMinus2: Math.pow(2, -2),\n    toMinus3: Math.pow(2, -3),\n    toMinus4: Math.pow(2, -4),\n    toMinus5: Math.pow(2, -5),\n    toMinus6: Math.pow(2, -6),\n    toMinus7: Math.pow(2, -7),\n    toMinus8: Math.pow(2, -8),\n    toMinus9: Math.pow(2, -9),\n    toMinus10: Math.pow(2, -10),\n    toMinus11: Math.pow(2, -11),\n    toMinus12: Math.pow(2, -12),\n    toMinus13: Math.pow(2, -13),\n    toMinus14: Math.pow(2, -14),\n    toMinus15: Math.pow(2, -15),\n    toMinus16: Math.pow(2, -16),\n    toMinus17: Math.pow(2, -17),\n    toMinus18: Math.pow(2, -18),\n    toMinus19: Math.pow(2, -19),\n    toMinus20: Math.pow(2, -20),\n    toMinus21: Math.pow(2, -21),\n    toMinus22: Math.pow(2, -22),\n    toMinus23: Math.pow(2, -23),\n    toMinus24: Math.pow(2, -24),\n    toMinus25: Math.pow(2, -25),\n    toMinus26: Math.pow(2, -26),\n    toMinus27: Math.pow(2, -27),\n    toMinus28: Math.pow(2, -28),\n    toMinus29: Math.pow(2, -29),\n    toMinus30: Math.pow(2, -30),\n    toMinus31: Math.pow(2, -31),\n    toMinus32: Math.pow(2, -32),\n  },\n  negPowTwo: {\n    to0: -Math.pow(2, 0),\n    to1: -Math.pow(2, 1),\n    to2: -Math.pow(2, 2),\n    to3: -Math.pow(2, 3),\n    to4: -Math.pow(2, 4),\n    to5: -Math.pow(2, 5),\n    to6: -Math.pow(2, 6),\n    to7: -Math.pow(2, 7),\n    to8: -Math.pow(2, 8),\n    to9: -Math.pow(2, 9),\n    to10: -Math.pow(2, 10),\n    to11: -Math.pow(2, 11),\n    to12: -Math.pow(2, 12),\n    to13: -Math.pow(2, 13),\n    to14: -Math.pow(2, 14),\n    to15: -Math.pow(2, 15),\n    to16: -Math.pow(2, 16),\n    to17: -Math.pow(2, 17),\n    to18: -Math.pow(2, 18),\n    to19: -Math.pow(2, 19),\n    to20: -Math.pow(2, 20),\n    to21: -Math.pow(2, 21),\n    to22: -Math.pow(2, 22),\n    to23: -Math.pow(2, 23),\n    to24: -Math.pow(2, 24),\n    to25: -Math.pow(2, 25),\n    to26: -Math.pow(2, 26),\n    to27: -Math.pow(2, 27),\n    to28: -Math.pow(2, 28),\n    to29: -Math.pow(2, 29),\n    to30: -Math.pow(2, 30),\n    to31: -Math.pow(2, 31),\n    to32: -Math.pow(2, 32),\n\n    toMinus1: -Math.pow(2, -1),\n    toMinus2: -Math.pow(2, -2),\n    toMinus3: -Math.pow(2, -3),\n    toMinus4: -Math.pow(2, -4),\n    toMinus5: -Math.pow(2, -5),\n    toMinus6: -Math.pow(2, -6),\n    toMinus7: -Math.pow(2, -7),\n    toMinus8: -Math.pow(2, -8),\n    toMinus9: -Math.pow(2, -9),\n    toMinus10: -Math.pow(2, -10),\n    toMinus11: -Math.pow(2, -11),\n    toMinus12: -Math.pow(2, -12),\n    toMinus13: -Math.pow(2, -13),\n    toMinus14: -Math.pow(2, -14),\n    toMinus15: -Math.pow(2, -15),\n    toMinus16: -Math.pow(2, -16),\n    toMinus17: -Math.pow(2, -17),\n    toMinus18: -Math.pow(2, -18),\n    toMinus19: -Math.pow(2, -19),\n    toMinus20: -Math.pow(2, -20),\n    toMinus21: -Math.pow(2, -21),\n    toMinus22: -Math.pow(2, -22),\n    toMinus23: -Math.pow(2, -23),\n    toMinus24: -Math.pow(2, -24),\n    toMinus25: -Math.pow(2, -25),\n    toMinus26: -Math.pow(2, -26),\n    toMinus27: -Math.pow(2, -27),\n    toMinus28: -Math.pow(2, -28),\n    toMinus29: -Math.pow(2, -29),\n    toMinus30: -Math.pow(2, -30),\n    toMinus31: -Math.pow(2, -31),\n    toMinus32: -Math.pow(2, -32),\n  },\n} as const;\n"],"file":"builtin.js"}