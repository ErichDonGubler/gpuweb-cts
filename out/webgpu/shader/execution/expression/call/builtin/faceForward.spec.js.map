{"version":3,"file":"faceForward.spec.js","names":["description","makeTestGroup","GPUTest","anyOf","f32","TypeF32","TypeVec","Vector","faceForwardIntervals","quantizeToF32","sparseVectorF32Range","makeCaseCache","allInputSources","run","builtin","g","d","f32_vec2","flatMap","i","j","map","k","makeCase","f32_vec3","f32_vec4","x","y","z","x_f32","y_f32","z_f32","intervals","input","expected","test","specURL","desc","params","u","combine","unimplemented","fn","t","cases","get"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/faceForward.spec.ts"],"sourcesContent":["export const description = `\nExecution tests for the 'faceForward' builtin function\n\nT is vecN<AbstractFloat>, vecN<f32>, or vecN<f16>\n@const fn faceForward(e1: T ,e2: T ,e3: T ) -> T\nReturns e1 if dot(e2,e3) is negative, and -e1 otherwise.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../../gpu_test.js';\nimport { anyOf } from '../../../../../util/compare.js';\nimport { f32, TypeF32, TypeVec, Vector } from '../../../../../util/conversion.js';\nimport { faceForwardIntervals } from '../../../../../util/f32_interval.js';\nimport { quantizeToF32, sparseVectorF32Range } from '../../../../../util/math.js';\nimport { makeCaseCache } from '../../case_cache.js';\nimport { allInputSources, Case, run } from '../../expression.js';\n\nimport { builtin } from './builtin.js';\n\nexport const g = makeTestGroup(GPUTest);\n\nexport const d = makeCaseCache('faceForward', {\n  f32_vec2: () => {\n    return sparseVectorF32Range(2).flatMap(i =>\n      sparseVectorF32Range(2).flatMap(j => sparseVectorF32Range(2).map(k => makeCase(i, j, k)))\n    );\n  },\n  f32_vec3: () => {\n    return sparseVectorF32Range(3).flatMap(i =>\n      sparseVectorF32Range(3).flatMap(j => sparseVectorF32Range(3).map(k => makeCase(i, j, k)))\n    );\n  },\n  f32_vec4: () => {\n    return sparseVectorF32Range(4).flatMap(i =>\n      sparseVectorF32Range(4).flatMap(j => sparseVectorF32Range(4).map(k => makeCase(i, j, k)))\n    );\n  },\n});\n\n/**\n * @returns a `faceForward` Case for a triplet of vectors of f32s input\n *\n * Needs to be a custom implementation, since faceFowardIntervals returns an\n * array of vector of intervals, which are to be treated as discrete\n * possibilities.\n */\nconst makeCase = (x: number[], y: number[], z: number[]): Case => {\n  x = x.map(quantizeToF32);\n  y = y.map(quantizeToF32);\n  z = z.map(quantizeToF32);\n\n  const x_f32 = x.map(f32);\n  const y_f32 = y.map(f32);\n  const z_f32 = z.map(f32);\n\n  const intervals = faceForwardIntervals(x, y, z);\n\n  return {\n    input: [new Vector(x_f32), new Vector(y_f32), new Vector(z_f32)],\n    expected: anyOf(...intervals),\n  };\n};\n\ng.test('abstract_float')\n  .specURL('https://www.w3.org/TR/WGSL/#float-builtin-functions')\n  .desc(`abstract float tests`)\n  .params(u => u.combine('inputSource', allInputSources).combine('vectorize', [2, 3, 4] as const))\n  .unimplemented();\n\ng.test('f32_vec2')\n  .specURL('https://www.w3.org/TR/WGSL/#numeric-builtin-functions')\n  .desc(`f32 tests using vec2s`)\n  .params(u => u.combine('inputSource', allInputSources))\n  .fn(async t => {\n    const cases = await d.get('f32_vec2');\n    await run(\n      t,\n      builtin('faceForward'),\n      [TypeVec(2, TypeF32), TypeVec(2, TypeF32), TypeVec(2, TypeF32)],\n      TypeVec(2, TypeF32),\n      t.params,\n      cases\n    );\n  });\n\ng.test('f32_vec3')\n  .specURL('https://www.w3.org/TR/WGSL/#numeric-builtin-functions')\n  .desc(`f32 tests using vec3s`)\n  .params(u => u.combine('inputSource', allInputSources))\n  .fn(async t => {\n    const cases = await d.get('f32_vec3');\n    await run(\n      t,\n      builtin('faceForward'),\n      [TypeVec(3, TypeF32), TypeVec(3, TypeF32), TypeVec(3, TypeF32)],\n      TypeVec(3, TypeF32),\n      t.params,\n      cases\n    );\n  });\n\ng.test('f32_vec4')\n  .specURL('https://www.w3.org/TR/WGSL/#numeric-builtin-functions')\n  .desc(`f32 tests using vec4s`)\n  .params(u => u.combine('inputSource', allInputSources))\n  .fn(async t => {\n    const cases = await d.get('f32_vec4');\n    await run(\n      t,\n      builtin('faceForward'),\n      [TypeVec(4, TypeF32), TypeVec(4, TypeF32), TypeVec(4, TypeF32)],\n      TypeVec(4, TypeF32),\n      t.params,\n      cases\n    );\n  });\n\ng.test('f16')\n  .specURL('https://www.w3.org/TR/WGSL/#float-builtin-functions')\n  .desc(`f16 tests`)\n  .params(u => u.combine('inputSource', allInputSources).combine('vectorize', [2, 3, 4] as const))\n  .unimplemented();\n"],"mappings":"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"}