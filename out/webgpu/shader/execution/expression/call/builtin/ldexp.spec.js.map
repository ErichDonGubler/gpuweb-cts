{"version":3,"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/ldexp.spec.ts"],"names":["description","makeTestGroup","GPUTest","correctlyRoundedThreshold","kValue","f32","i32","TypeF32","TypeI32","biasedRange","linearRange","quantizeToI32","run","builtin","g","test","specURL","desc","params","u","combine","undefined","fn","t","truthFunc","e1","e2","i32_e2","result","Math","pow","Number","isFinite","positive","max","min","input","expected","e1_range","e2_range","map","x","round","cases","forEach","c","push","cfg","cmpFloats"],"mappings":"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","sourcesContent":["export const description = `\nExecution Tests for the 'ldexp' builtin function\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../../gpu_test.js';\nimport { correctlyRoundedThreshold } from '../../../../../util/compare.js';\nimport { kValue } from '../../../../../util/constants.js';\nimport { f32, i32, TypeF32, TypeI32 } from '../../../../../util/conversion.js';\nimport { biasedRange, linearRange, quantizeToI32 } from '../../../../../util/math.js';\nimport { Case, Config, run } from '../../expression.js';\n\nimport { builtin } from './builtin.js';\n\nexport const g = makeTestGroup(GPUTest);\n\ng.test('f32')\n  .specURL('https://www.w3.org/TR/2021/WD-WGSL-20210929/#float-builtin-functions')\n  .desc(\n    `\nldexp:\nT is f32 or vecN<f32> I is i32 or vecN<i32>, where I is a scalar if T is a scalar, or a vector when T is a vector ldexp(e1: T ,e2: I ) -> T Returns e1 * 2e2. Component-wise when T is a vector. (GLSLstd450Ldexp)\n`\n  )\n  .params(u =>\n    u\n      .combine('storageClass', ['uniform', 'storage_r', 'storage_rw'] as const)\n      .combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .fn(async t => {\n    const truthFunc = (e1: number, e2: number): Case | undefined => {\n      const i32_e2 = quantizeToI32(e2);\n      const result = e1 * Math.pow(2, i32_e2);\n      // Unclear what the expected behaviour for values that overflow f32 bounds, see https://github.com/gpuweb/gpuweb/issues/2631\n      if (!Number.isFinite(result)) {\n        return undefined;\n      } else if (result > kValue.f32.positive.max) {\n        return undefined;\n      } else if (result < kValue.f32.positive.min) {\n        return undefined;\n      }\n      return { input: [f32(e1), i32(e2)], expected: f32(result) };\n    };\n\n    const e1_range: Array<number> = [\n      //  -2^32 < x <= -1, biased towards -1\n      ...biasedRange(-1, -(2 ** 32), 50),\n      // -1 <= x <= 0, linearly spread\n      ...linearRange(-1, 0, 20),\n      // 0 <= x <= -1, linearly spread\n      ...linearRange(0, 1, 20),\n      // 1 <= x < 2^32, biased towards 1\n      ...biasedRange(1, 2 ** 32, 50),\n    ];\n\n    const e2_range: Array<number> = [\n      // -127 < x <= 0, biased towards 0\n      ...biasedRange(0, -127, 20).map(x => Math.round(x)),\n      // 0 <= x < 128, biased towards 0\n      ...biasedRange(0, 128, 20).map(x => Math.round(x)),\n    ];\n\n    const cases: Array<Case> = [];\n    e1_range.forEach(e1 => {\n      e2_range.forEach(e2 => {\n        const c = truthFunc(e1, e2);\n        if (c !== undefined) {\n          cases.push(c);\n        }\n      });\n    });\n    const cfg: Config = t.params;\n    cfg.cmpFloats = correctlyRoundedThreshold();\n    run(t, builtin('ldexp'), [TypeF32, TypeI32], TypeF32, cfg, cases);\n  });\n"],"file":"ldexp.spec.js"}