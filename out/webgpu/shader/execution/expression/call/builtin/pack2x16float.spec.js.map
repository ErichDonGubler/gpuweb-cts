{"version":3,"file":"pack2x16float.spec.js","names":["description","makeTestGroup","assert","GPUTest","anyOf","f32","pack2x16float","Scalar","TypeF32","TypeU32","TypeVec","u32","vec2","quantizeToF32","vectorTestValues","allInputSources","run","builtin","g","cmp","expectation","got","matched","undefined","value","expected","test","specURL","desc","params","u","combine","fn","t","makeCase","x","y","results","input","map","cases","inputSource","v"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/pack2x16float.spec.ts"],"sourcesContent":["export const description = `\nConverts two floating point values to half-precision floating point numbers, and then combines them into one u32 value.\nComponent e[i] of the input is converted to a IEEE-754 binary16 value,\nwhich is then placed in bits 16 × i through 16 × i + 15 of the result.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { assert } from '../../../../../../common/util/util.js';\nimport { GPUTest } from '../../../../../gpu_test.js';\nimport { anyOf, Comparator } from '../../../../../util/compare.js';\nimport {\n  f32,\n  pack2x16float,\n  Scalar,\n  TypeF32,\n  TypeU32,\n  TypeVec,\n  u32,\n  vec2,\n} from '../../../../../util/conversion.js';\nimport { quantizeToF32, vectorTestValues } from '../../../../../util/math.js';\nimport { allInputSources, Case, run } from '../../expression.js';\n\nimport { builtin } from './builtin.js';\n\nexport const g = makeTestGroup(GPUTest);\n\n/**\n * @returns a custom comparator for a possible result from pack2x16float\n * @param expectation element of the array generated by pack2x16float\n */\nexport function cmp(expectation: number | undefined): Comparator {\n  return got => {\n    assert(got instanceof Scalar, `Received non-Scalar Value in pack2x16float comparator`);\n    let matched = true;\n    if (expectation !== undefined) {\n      matched = (got.value as number) === expectation;\n    }\n\n    return {\n      matched,\n      got: `${got}`,\n      expected: `${expectation !== undefined ? u32(expectation) : 'Any'}`,\n    };\n  };\n}\n\ng.test('pack')\n  .specURL('https://www.w3.org/TR/WGSL/#pack-builtin-functions')\n  .desc(\n    `\n@const fn pack2x16float(e: vec2<f32>) -> u32\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources))\n  .fn(async t => {\n    const makeCase = (x: number, y: number): Case => {\n      x = quantizeToF32(x);\n      y = quantizeToF32(y);\n      const results = pack2x16float(x, y);\n      return { input: [vec2(f32(x), f32(y))], expected: anyOf(...results.map(cmp)) };\n    };\n\n    const cases: Array<Case> = vectorTestValues(2, t.params.inputSource === 'const').map(v => {\n      return makeCase(...(v as [number, number]));\n    });\n\n    await run(t, builtin('pack2x16float'), [TypeVec(2, TypeF32)], TypeU32, t.params, cases);\n  });\n"],"mappings":";AAAA;AAAA,GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,kDAAkD;AAChF,SAASC,MAAM,QAAQ,uCAAuC;AAC9D,SAASC,OAAO,QAAQ,4BAA4B;AACpD,SAASC,KAAK,QAAoB,gCAAgC;AAClE;AACEC,GAAG;AACHC,aAAa;AACbC,MAAM;AACNC,OAAO;AACPC,OAAO;AACPC,OAAO;AACPC,GAAG;AACHC,IAAI;AACC,mCAAmC;AAC1C,SAASC,aAAa,EAAEC,gBAAgB,QAAQ,6BAA6B;AAC7E,SAASC,eAAe,EAAQC,GAAG,QAAQ,qBAAqB;;AAEhE,SAASC,OAAO,QAAQ,cAAc;;AAEtC,OAAO,MAAMC,CAAC,GAAGjB,aAAa,CAACE,OAAO,CAAC;;AAEvC;AACA;AACA;AACA;AACA,OAAO,SAASgB,GAAG,CAACC,WAA+B,EAAc;EAC/D,OAAO,CAAAC,GAAG,KAAI;IACZnB,MAAM,CAACmB,GAAG,YAAYd,MAAM,EAAG,uDAAsD,CAAC;IACtF,IAAIe,OAAO,GAAG,IAAI;IAClB,IAAIF,WAAW,KAAKG,SAAS,EAAE;MAC7BD,OAAO,GAAID,GAAG,CAACG,KAAK,KAAgBJ,WAAW;IACjD;;IAEA,OAAO;MACLE,OAAO;MACPD,GAAG,EAAG,GAAEA,GAAI,EAAC;MACbI,QAAQ,EAAG,GAAEL,WAAW,KAAKG,SAAS,GAAGZ,GAAG,CAACS,WAAW,CAAC,GAAG,KAAM;IACpE,CAAC;EACH,CAAC;AACH;;AAEAF,CAAC,CAACQ,IAAI,CAAC,MAAM,CAAC;AACXC,OAAO,CAAC,oDAAoD,CAAC;AAC7DC,IAAI;AACF;AACL;AACA,CAAC,CACE;;AACAC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,aAAa,EAAEhB,eAAe,CAAC,CAAC;AACtDiB,EAAE,CAAC,OAAMC,CAAC,KAAI;EACb,MAAMC,QAAQ,GAAG,CAACC,CAAS,EAAEC,CAAS,KAAW;IAC/CD,CAAC,GAAGtB,aAAa,CAACsB,CAAC,CAAC;IACpBC,CAAC,GAAGvB,aAAa,CAACuB,CAAC,CAAC;IACpB,MAAMC,OAAO,GAAG/B,aAAa,CAAC6B,CAAC,EAAEC,CAAC,CAAC;IACnC,OAAO,EAAEE,KAAK,EAAE,CAAC1B,IAAI,CAACP,GAAG,CAAC8B,CAAC,CAAC,EAAE9B,GAAG,CAAC+B,CAAC,CAAC,CAAC,CAAC,EAAEX,QAAQ,EAAErB,KAAK,CAAC,GAAGiC,OAAO,CAACE,GAAG,CAACpB,GAAG,CAAC,CAAC,CAAC,CAAC;EAChF,CAAC;;EAED,MAAMqB,KAAkB,GAAG1B,gBAAgB,CAAC,CAAC,EAAEmB,CAAC,CAACJ,MAAM,CAACY,WAAW,KAAK,OAAO,CAAC,CAACF,GAAG,CAAC,CAAAG,CAAC,KAAI;IACxF,OAAOR,QAAQ,CAAC,GAAIQ,CAAsB,CAAC;EAC7C,CAAC,CAAC;;EAEF,MAAM1B,GAAG,CAACiB,CAAC,EAAEhB,OAAO,CAAC,eAAe,CAAC,EAAE,CAACP,OAAO,CAAC,CAAC,EAAEF,OAAO,CAAC,CAAC,EAAEC,OAAO,EAAEwB,CAAC,CAACJ,MAAM,EAAEW,KAAK,CAAC;AACzF,CAAC,CAAC"}